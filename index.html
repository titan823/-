case 'reverseDialogues': {
                // カッコの入れ子（ネスト）に完全対応した抽出ロジック
                let depth = 0;
                let startIndex = -1;
                const dialogues = [];
                const parsedText = [];
                let lastEnd = 0;

                // 1文字ずつ順番に確認していく
                for (let i = 0; i < text.length; i++) {
                    if (text[i] === '「') {
                        if (depth === 0) {
                            startIndex = i; // 一番外側の「 を見つけた位置
                        }
                        depth++; // 深さを+1
                    } else if (text[i] === '」') {
                        if (depth > 0) {
                            depth--; // 深さを-1
                            if (depth === 0) {
                                // 一番外側の 」 に到達した時だけ、セリフとして切り出す
                                const endIndex = i;
                                dialogues.push(text.substring(startIndex, endIndex + 1));
                                parsedText.push(text.substring(lastEnd, startIndex));
                                parsedText.push('___DIALOGUE_PLACEHOLDER___'); // 入れ替え用の目印
                                lastEnd = endIndex + 1;
                            }
                        }
                    }
                }
                parsedText.push(text.substring(lastEnd)); // 最後の地の文を追加

                if (dialogues.length > 1) {
                    dialogues.reverse(); // 抽出したセリフの順序だけをひっくり返す
                    let finalStr = "";
                    let dIdx = 0;
                    
                    // 地の文と、ひっくり返したセリフを結合する
                    for (let i = 0; i < parsedText.length; i++) {
                        if (parsedText[i] === '___DIALOGUE_PLACEHOLDER___') {
                            finalStr += dialogues[dIdx++];
                        } else {
                            finalStr += parsedText[i];
                        }
                    }
                    text = finalStr;
                    showToast('セリフの順序を反転しました');
                } else {
                    showToast('反転するセリフ(「」)が2つ以上ありません');
                    return; 
                }
                break;
            }
